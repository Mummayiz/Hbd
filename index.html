<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Madi — Celebration & Quotes</title>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --pink:#ffadc6;--rose:#ff4f88;--lav:#c7b5ff;--cream:#fff7fb;
      --gold:#f4d7a1;--ink:#4b3f4e;--bg:#fbeef3;--shadow:0 15px 35px rgba(0,0,0,.08)
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0;font-family:Poppins,system-ui,Segoe UI,Roboto;color:var(--ink);
      background:linear-gradient(180deg,var(--bg),#fde9ff 60%, #fff);overflow-x:hidden;
    }
    a{color:var(--rose);text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:0 20px}

    /* nav */
    header.site-nav{display:flex;justify-content:space-between;align-items:center;padding:18px 0}
    header.site-nav .brand{font-family:"Dancing Script";font-size:20px;color:#a33c60}
    header.site-nav nav{display:flex;gap:12px;align-items:center}
    .nav-link{background:transparent;border:none;padding:10px 14px;border-radius:999px;cursor:pointer;font-weight:700;color:var(--ink)}
    .nav-link.active{background:linear-gradient(135deg,var(--rose),var(--lav));color:#fff;box-shadow:0 8px 20px rgba(0,0,0,.12)}
    .cta{padding:8px 14px;border-radius:40px;background:linear-gradient(135deg,var(--rose),var(--lav));color:#fff;border:none;cursor:pointer;font-weight:700}

    /* hero / letter */
    .hero{position:relative;min-height:80vh;display:grid;place-items:center;text-align:center;padding:24px 24px 80px;background:linear-gradient(135deg,#fff7fb,#ffe2f0,#f8d7ff);border-bottom:1px solid rgba(160,100,120,.04)}
    .hero h1{font-family:"Dancing Script",cursive;font-size:clamp(40px,7vw,72px);margin:0 0 8px;color:#a33c60;text-shadow:0 2px 0 #fff8}
    .subtitle{font-size:18px;color:#5a485a;margin:0}
    .enter-cta{margin-top:18px}

    .card{background:#fff;border-radius:22px;box-shadow:var(--shadow);padding:26px;backdrop-filter:blur(6px);max-width:900px;margin:18px auto}
    .typewriter{min-height:140px;white-space:pre-wrap;line-height:1.7;font-size:18px;border-left:3px solid var(--rose);padding-left:14px;color:#4b3f4e}

    /* compliments hearts */
    .compliments{margin-top:18px;display:grid;grid-template-columns:repeat(auto-fit,minmax(80px,1fr));gap:14px;justify-items:center}
    .floating-heart{width:56px;height:56px;position:relative;cursor:pointer;background: radial-gradient(circle at 30% 30%, #ff7aa2, #ff4f88);border-radius:50% 50% 0 0;transform:rotate(-45deg);margin:6px;animation:float 6s infinite;box-shadow:0 6px 12px rgba(0,0,0,.22);border:none}
    .floating-heart:before,.floating-heart:after{content:"";position:absolute;width:56px;height:56px;background:radial-gradient(circle at 30% 30%, #ff7aa2, #ff4f88);border-radius:50%}
    .floating-heart:before{top:-28px;left:0} .floating-heart:after{top:0;left:28px}
    @keyframes float{0%{transform:rotate(-45deg) translateY(0)}50%{transform:rotate(-45deg) translateY(-12px)}100%{transform:rotate(-45deg) translateY(0)}}
    .compliment-box{margin-top:10px;font-size:20px;font-weight:700;text-align:center;color:#a33c60;min-height:44px}

    /* fireworks */
    .starry{position:relative;border-radius:12px;overflow:hidden;height:420px;background:radial-gradient(circle at bottom, #6a5a9b, #312a59);margin:22px 0}
    canvas#fireworks{position:absolute;inset:0;display:block}
    .starry .overlay{position:relative;z-index:2;padding:48px 24px;text-align:center;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,.5)}

    /* music */
    .music-player{position:fixed;bottom:18px;right:18px;background:#fff;border-radius:50px;box-shadow:0 8px 20px rgba(0,0,0,.12);padding:8px 14px;display:flex;align-items:center;gap:10px;z-index:999;font-size:14px;font-weight:600;color:#a33c60}
    .music-player select{border:none;background:transparent;font-weight:600;color:#a33c60;cursor:pointer}
    .music-player button{border:none;background:transparent;cursor:pointer;font-size:18px}

    /* quotes / gallery */
    .lead{font-family:'Dancing Script';font-size:32px;color:#a33c60;margin:8px 0}
    .quote{background:#fff;padding:18px;border-radius:12px;box-shadow:0 12px 30px rgba(0,0,0,.06);font-size:18px;margin-bottom:16px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .card-media{background:#fff;border-radius:12px;padding:8px;box-shadow:0 8px 20px rgba(0,0,0,.06);overflow:hidden;cursor:pointer}
    .card-media img, .card-media video{width:100%;height:160px;object-fit:cover;display:block;border-radius:8px}
    .actions{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}

    /* quotes-player small UI */
    .quotes-player { display:flex; gap:10px; align-items:center; justify-content:flex-start; background:#fff; padding:12px; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,.06); margin-bottom:12px; }
    .quotes-player select{border:none;background:transparent;font-weight:600;color:#a33c60;cursor:pointer}
    .quotes-player button{border:none;background:linear-gradient(135deg,var(--rose),var(--lav));color:#fff;padding:8px 12px;border-radius:999px;cursor:pointer;font-weight:700}

    /* lightbox */
    .lb-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.88);display:flex;align-items:center;justify-content:center;z-index:9999;padding:18px}
    .lb-media{max-width:92%;max-height:92%;border-radius:10px;box-shadow:0 20px 60px rgba(0,0,0,.6)}
    .lb-close{position:fixed;top:16px;right:16px;color:#fff;font-size:26px;z-index:10000;cursor:pointer;background:transparent;border:none}

    /* popup */
    .popup-modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:white;padding:28px 32px;border-radius:14px;box-shadow:0 12px 40px rgba(0,0,0,.4);z-index:10010;text-align:center;font-family:"Dancing Script",cursive;font-size:28px;color:#a33c60}
    .popup-close{margin-top:12px;padding:8px 14px;border-radius:10px;border:none;background:linear-gradient(135deg,var(--rose),var(--lav));color:#fff;cursor:pointer}

    footer{padding:28px 20px;text-align:center;color:#856b79}
    @media (max-width:600px){ .card-media img, .card-media video{height:120px} .starry{height:300px} }
  </style>
</head>
<body>
  <div class="container">
    <header class="site-nav" role="navigation" aria-label="Main nav">
      <div class="brand">Madi's Birthday</div>
      <nav>
        <button class="nav-link active" data-view="home">Celebrate</button>
        <button class="nav-link" data-view="quotes">Romantic Quotes</button>
        <button class="cta" id="enterBtn" aria-controls="letter">✨ Begin the Celebration ✨</button>
      </nav>
    </header>

    <main id="app">
      <!-- HOME / CELEBRATION VIEW -->
      <section id="view-home" class="view" aria-hidden="false">
        <section class="hero" role="banner">
          <div class="confetti" id="confetti" aria-hidden="true"></div>
          <div>
            <h1>Happy Birthday, Madiha Kounain 🎉💖</h1>
            <p class="subtitle">A magical surprise is waiting for you ✨</p>
            <div style="margin-top:14px">
              <button class="cta enter-cta" id="enterBtn2">Start the Celebration</button>
            </div>
          </div>
        </section>

        <section>
          <div class="card" role="region" aria-label="Birthday letter">
            <h2 style="font-family:'Dancing Script';font-size:32px;color:#a33c60;margin:0 0 8px">My Birthday Letter 🌹</h2>
            <div id="typewriter" class="typewriter" aria-live="polite"></div>
          </div>
        </section>

        <section style="margin-top:14px">
          <div class="card" style="padding:18px">
            <h3 style="font-family:'Dancing Script';font-size:24px;color:#a33c60;margin:0 0 8px">Reasons Why I Adore You 💕</h3>
            <div class="compliments" id="heartsContainer" aria-label="compliments"></div>
            <div class="compliment-box" id="complimentBox">Click a heart 💖</div>
          </div>
        </section>

        <section style="margin-top:18px">
          <div class="starry" aria-hidden="false">
            <canvas id="fireworks"></canvas>
            <div class="overlay" style="z-index:2;padding:40px 24px;text-align:center">
              <h3 style="font-family:'Dancing Script';font-size:30px;color:#fff;margin:0 0 8px">🎉 A Special Surprise 🎉</h3>
              <div style="display:flex;gap:12px;justify-content:center;margin-top:12px">
                <!-- single celebrate button (merged) -->
                <button class="cta" id="boom">🎆 Celebrate 🎆</button>
              </div>
            </div>
          </div>
        </section>
      </section>

      <!-- QUOTES / GALLERY VIEW (with +2 images +2 videos) -->
<section id="view-quotes" class="view" aria-hidden="true" style="display:none; padding-top:8px;">
  <h2 class="lead">Romantic Quotes</h2>

  <!-- small quotes music player -->
  <div class="quotes-player" role="region" aria-label="Quotes music player">
    <label for="quotesSongSelect" style="font-weight:700;color:#856b79;margin-right:6px">Play song:</label>
    <select id="quotesSongSelect" aria-label="Select romantic song">
      <option value="rom1">Romantic Song 1</option>
      <option value="rom2">Romantic Song 2</option>
    </select>
    <button id="quotesPlay" aria-pressed="false">Play ▶</button>
    <span id="quotesAudioStatus" style="margin-left:10px;font-size:13px;color:#856b79"></span>
  </div>

  <!-- quote box -->
  <div class="quote" id="quoteBox">"Happy Birthday Mere Jaan." </div>
  <div class="actions" style="margin-top:12px">
    <button id="randomQuote" class="cta">Random Quote</button>
  </div>

  <!-- gallery (now 5 images + 2 videos) -->
  <section aria-label="Gallery">
    <div class="grid" id="gallery">
      <!-- existing three images -->
      <div class="card-media" role="button" tabindex="0" data-type="image" data-src="assets/madi1.jpg">
        <img data-src="assets/madi1.jpg" loading="lazy" alt="Memory 1" class="lazy-img">
      </div>

      <div class="card-media" role="button" tabindex="0" data-type="image" data-src="assets/madi2.jpg">
        <img data-src="assets/madi2.jpg" loading="lazy" alt="Memory 2" class="lazy-img">
      </div>

      <div class="card-media" role="button" tabindex="0" data-type="image" data-src="assets/madi3.jpg">
        <img data-src="assets/madi3.jpg" loading="lazy" alt="Memory 3" class="lazy-img">
      </div>

      <!-- NEW: two additional images -->
      <div class="card-media" role="button" tabindex="0" data-type="image" data-src="assets/madi4.jpg">
        <img data-src="assets/madi4.jpg" loading="lazy" alt="Memory 4" class="lazy-img">
      </div>

      <div class="card-media" role="button" tabindex="0" data-type="image" data-src="assets/madi5.jpg">
        <img data-src="assets/madi5.jpg" loading="lazy" alt="Memory 5" class="lazy-img">
      </div>

      <!-- NEW: two videos (poster optional) -->
      <div class="card-media" role="button" tabindex="0" data-type="video" data-src="assets/clip1.mp4">
        <video data-src="assets/clip1.mp4" poster="" muted playsinline class="lazy-video"></video>
      </div>

      <div class="card-media" role="button" tabindex="0" data-type="video" data-src="assets/clip2.mp4">
        <video data-src="assets/clip2.mp4" poster="" muted playsinline class="lazy-video"></video>
      </div>
    </div>
  </section>
</section>

    </main>

    <footer><p style="margin:18px 0 0">Made with ❤️ by Mummayiz • <span id="year"></span></p></footer>
  </div>

  <!-- persistent music player (unchanged) -->
  <div class="music-player" role="region" aria-label="Music player">
    🎶
    <select id="songSelect" aria-label="Select song">
      <option value="505">505</option>
      <option value="lover">Lover of Mine</option>
    </select>
    <button id="muteBtn" title="Mute/unmute" aria-pressed="false">🔊</button>
    <span id="audioStatus" style="margin-left:10px;font-size:13px;color:#856b79"></span>
  </div>

  <!-- celebration popup element -->
  <div id="celebrationPopup" style="display:none;position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:white;padding:28px 36px;border-radius:16px;box-shadow:0 12px 40px rgba(0,0,0,.35);z-index:10020;font-family:'Dancing Script',cursive;font-size:30px;color:#a33c60;text-align:center;">
    Happy Birthday again, Madi! 🎂💖
    <div style="margin-top:12px"><button id="celebrationClose" class="cta" style="padding:8px 14px;font-size:16px">Close</button></div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));

  /* ============================
     SPA navigation
     ============================ */
  (function initNav(){
    try{
      const navLinks = document.querySelectorAll('.nav-link');
      const views = { home: $('#view-home'), quotes: $('#view-quotes') };
      function showView(name, push=true){
        Object.keys(views).forEach(k=>{
          const el = views[k];
          if(!el) return;
          if(k===name){ el.style.display='block'; el.setAttribute('aria-hidden','false'); }
          else { el.style.display='none'; el.setAttribute('aria-hidden','true'); }
        });
        navLinks.forEach(btn => btn.classList.toggle('active', btn.dataset.view === name));
        if(push) history.pushState({view:name}, '', '#' + name);
        lazyObserver && lazyObserver.takeRecords && lazyObserver.takeRecords();

        if(name === 'quotes') {
          const qStatus = $('#quotesAudioStatus');
          if(qStatus && qStatus.innerText === '') qStatus.innerText = 'Pick a song and click Play';
        }
      }
      navLinks.forEach(btn => btn.addEventListener('click', ()=> showView(btn.dataset.view)));
      showView(location.hash ? location.hash.replace('#','') : 'home', false);
      window.addEventListener('popstate', e => {
        const v = (e.state && e.state.view) || (location.hash ? location.hash.replace('#','') : 'home');
        showView(v, false);
      });
    }catch(e){ console.warn('nav init', e); }
  })();

  /* ============================
     Persistent audio (unchanged)
     ============================ */
  let audioReady = false;
  window._bgAudio = window._bgAudio || new Audio();
  const audio = window._bgAudio;
  audio.loop = true;
  audio.preload = 'auto';
  const sources = {505:'assets/505.mp3', lover:'assets/lover.mp3'};

  async function headExists(url){
    try {
      const res = await fetch(url, { method: 'HEAD' });
      return res.ok;
    } catch(e){ return false; }
  }

  (async function detectAudio(){
    const found505 = await headExists(sources[505]);
    const foundLover = await headExists(sources.lover);
    if(found505){ audio.src = sources[505]; audioReady = true; $('#audioStatus').innerText = ''; }
    else if(foundLover){ audio.src = sources[lover]; audioReady = true; $('#audioStatus').innerText = ''; }
    else { audioReady = false; $('#audioStatus').innerText = 'No audio found in assets/ (add assets/505.mp3)'; }
  })();

  $('#songSelect')?.addEventListener('change', async ()=>{ const v = $('#songSelect').value; const url = sources[v]; if(url && await headExists(url)){ audio.pause(); audio.src = url; try{ await audio.play(); $('#audioStatus').innerText=''; } catch(e){ $('#audioStatus').innerText='Playback blocked until gesture'; } audioReady = true; } else { $('#audioStatus').innerText = 'Selected audio file missing'; } });

  $('#muteBtn')?.addEventListener('click', ()=> {
    audio.muted = !audio.muted;
    $('#muteBtn').innerText = audio.muted ? '🔇':'🔊';
    $('#muteBtn').setAttribute('aria-pressed', String(audio.muted));
  });

  async function startMusic(){
    if(!audioReady){ $('#audioStatus').innerText = 'Audio not available'; return; }
    try { await audio.play(); $('#audioStatus').innerText=''; } catch(e){ console.warn('play blocked', e); $('#audioStatus').innerText='Playback blocked — click a button to start'; }
  }

  /* ============================
     Typewriter (only once)
     ============================ */
  (function typewriterInit(){
    const letterText = `Happy Birthday MJ, my sweetest love.\n\nThank you for being my safe place, my happiest adventure, and my favorite hello. I love your smile, your kindness, and the way you light up even the quietest days.\n\nI am proud of you—of everything you are and all that you are becoming. I’m always on your side. Today is all for you.\n\nLet’s keep collecting tiny moments, inside jokes, and big dreams… together.\n\nForever yours,\nMummayiz ❤️`;
    let tpos=0, started=false; const tw = $('#typewriter');
    function startTypewriter(speed = 36){
      if(!tw || started) return;
      started = true;
      (function step(){
        if(tpos < letterText.length){
          tw.innerHTML += letterText.charAt(tpos);
          tpos++;
          const ch = letterText.charAt(tpos);
          const delay = (ch === '\n') ? 30 : (/[.,—?!]/.test(ch) ? speed + 90 : speed);
          setTimeout(step, delay);
        }
      })();
    }
    $('#enterBtn')?.addEventListener('click', ()=> startTypewriter());
    $('#enterBtn2')?.addEventListener('click', ()=> startTypewriter());
  })();

  /* ============================
     Compliments hearts
     ============================ */
  (function complimentsInit(){
    const compliments = ['You make me laugh 💕','You’re my safe place 🤗','Your smile melts my heart 😍','You brighten my darkest days 🌞','You’re my best friend 🥰','You are so thoughtful 🌸','You inspire me ✨','You are my sunshine ☀️','You believe in me 🌟','You’re my favorite hello 💖','You’re my forever 💍','You’re my lucky charm 🍀','Your kindness amazes me 🌷','You’re so beautiful 💃','You complete me 💞','You understand me 🎶','You make life magical 🦋','You make me proud 💪','You are my dream girl 🌈','I love you endlessly ❤️','You’re the melody to my heart 🎵','You make every day special 🌹','You’re the reason I believe in love 💘','You’re my sweetest destiny 💎'];
    const container = $('#heartsContainer'), box = $('#complimentBox');
    if(!container || !box) return;
    compliments.forEach(c=>{
      const b=document.createElement('button'); b.className='floating-heart'; b.setAttribute('aria-label',c);
      b.addEventListener('click', (e)=> { box.innerText=c; showPopup(e.clientX,e.clientY); });
      b.addEventListener('keydown',(e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); b.click(); }});
      container.appendChild(b);
    });
    function showPopup(x,y){ const popup = document.createElement('div'); popup.className='popup'; popup.style.position='fixed'; popup.style.left = Math.min(Math.max(x-16,8), window.innerWidth-60)+'px'; popup.style.top = Math.min(Math.max(y-24,8), window.innerHeight-60)+'px'; popup.style.zIndex=9999; popup.style.fontSize='26px'; popup.style.pointerEvents='none'; popup.innerText = ['✨','💕','🌸','💖','🌹','🌟'][Math.floor(Math.random()*6)]; document.body.appendChild(popup); popup.animate([{opacity:1, transform:'translateY(0) scale(1)'},{opacity:0, transform:'translateY(-60px) scale(1.3)'}], {duration:1400, easing:'ease-out'}); setTimeout(()=> popup.remove(),1500); }
  })();

  /* ============================
     Fireworks & Celebrate (merged)
     ============================ */
  (function fireworksInit(){
    const canvas = $('#fireworks');
    if(!canvas) return;
    const ctx = canvas.getContext('2d'); let particles=[];
    function fit(){ const container = canvas.parentElement; canvas.style.width='100%'; const r = window.devicePixelRatio||1; const w = container.clientWidth; const h = container.clientHeight || 400; canvas.width = Math.floor(w*r); canvas.height = Math.floor(h*r); canvas.style.height = h + 'px'; ctx.setTransform(r,0,0,r,0,0); }
    window.addEventListener('resize', fit); fit();
    function Particle(x,y,c){ this.x=x; this.y=y; this.c=c; this.r=Math.random()*2+1.5; this.a=1; const s=Math.random()*4+1.5; const ang=Math.random()*Math.PI*2; this.dx=Math.cos(ang)*s; this.dy=Math.sin(ang)*s; this.g=0.03+Math.random()*0.04; }
    Particle.prototype.update=function(){ this.dx*=0.99; this.dy+=this.g; this.x+=this.dx; this.y+=this.dy; this.a-=0.012+Math.random()*0.006; }
    Particle.prototype.draw=function(){ ctx.save(); ctx.globalAlpha = Math.max(this.a,0); ctx.beginPath(); ctx.arc(this.x,this.y,this.r,0,Math.PI*2); ctx.fillStyle=this.c; ctx.fill(); ctx.restore(); }
    function boom(x=null,y=null){ const rect=canvas.getBoundingClientRect(); const cx = x??rect.width/2; const cy = y??rect.height/2; const colors=['#ffadc6','#ff7aa2','#c7b5ff','#f4d7a1','#ffd6e8']; for(let i=0;i<80;i++) particles.push(new Particle(cx+(Math.random()-0.5)*80, cy+(Math.random()-0.5)*80, colors[i%colors.length])); }
    function animate(){ requestAnimationFrame(animate); ctx.clearRect(0,0,canvas.width,canvas.height); for(let i=particles.length-1;i>=0;i--){ const p=particles[i]; p.update(); p.draw(); if(p.a<=0 || p.y>canvas.height+60) particles.splice(i,1);} }
    animate();

    function showCelebrationPopup(){
      const popup = $('#celebrationPopup');
      if(!popup) return;
      popup.style.display = 'block';
      const close = $('#celebrationClose');
      if(close) close.onclick = () => popup.style.display = 'none';
      setTimeout(()=> { if(popup) popup.style.display = 'none'; }, 4000);
    }

    const celebrateBtn = $('#boom');
    if(celebrateBtn){
      celebrateBtn.addEventListener('click', async ()=>{
        try {
          // small floating popups
          for(let i=0;i<18;i++){ setTimeout(()=> { const x=Math.random()*window.innerWidth; const y=Math.random()*window.innerHeight; const p=document.createElement('div'); p.className='popup'; p.style.position='fixed'; p.style.left=x+'px'; p.style.top=y+'px'; p.style.zIndex=9999; p.style.fontSize='26px'; p.innerText=['✨','🎉','💖','🌸'][Math.floor(Math.random()*4)]; document.body.appendChild(p); setTimeout(()=>p.remove(),1200); }, i*50); }
          boom();
          showCelebrationPopup();
          await startMusic(); // try to start audio (user gesture)
        } catch(e){ console.warn('celebrate click failed', e); }
      });
    }

    // fire once when scrolled to bottom (optional, one-time)
    let scrolledTriggered = false;
    window.addEventListener('scroll', ()=>{
      if(!scrolledTriggered && (window.innerHeight + window.scrollY >= document.body.offsetHeight - 2)){
        scrolledTriggered = true;
        boom();
      }
    });
  })();

  /* ============================
     Quotes, lightbox, gallery click handler
     ============================ */
  (function galleryInit(){
    const quotes = [
      "I love you not only for what you are, but for what I am when I am with you. ",
      "You are my today and all of my tomorrows",
      "I look at you and see the rest of my life in front of my eyes.",
      "You are every reason, every hope, and every dream I've ever had",
      "You are the love of my Life",
      "Where there is love there is life. "
    ];
    $('#randomQuote')?.addEventListener('click', ()=> $('#quoteBox').innerText = quotes[Math.floor(Math.random()*quotes.length)]);

    function openLightbox(type, src, caption){
  // create overlay
  const overlay = document.createElement('div');
  overlay.className = 'lb-overlay';
  overlay.tabIndex = 0;
  overlay.style.zIndex = 99999;

  // close button
  const closeBtn = document.createElement('button');
  closeBtn.className = 'lb-close';
  closeBtn.innerText = '✕';
  closeBtn.addEventListener('click', () => overlay.remove());

  // container for media (image or video)
  let media;

  if (type === 'image') {
    media = document.createElement('img');
    media.className = 'lb-media';
    media.alt = caption || 'Photo';
    media.src = src;
    media.loading = 'eager';
  } else {
    media = document.createElement('video');
    media.className = 'lb-media';
    media.controls = true;
    media.playsInline = true;
    media.autoplay = false;
    media.src = src;
    media.load();

    media.play().then(()=>{}).catch(err => {
      console.warn('Autoplay blocked or play failed for', src, err);
      const playHint = document.createElement('div');
      playHint.style.position = 'absolute';
      playHint.style.bottom = '18px';
      playHint.style.left = '50%';
      playHint.style.transform = 'translateX(-50%)';
      playHint.style.background = 'rgba(0,0,0,0.35)';
      playHint.style.padding = '8px 12px';
      playHint.style.borderRadius = '999px';
      playHint.style.color = '#fff';
      playHint.style.fontSize = '14px';
      playHint.style.zIndex = 10001;
      playHint.style.cursor = 'pointer';
      playHint.innerText = '▶ Tap to play';
      playHint.addEventListener('click', (ev) => {
        ev.stopPropagation();
        media.play().catch(()=>{});
        if (playHint && playHint.parentElement) playHint.remove();
      });
      overlay.appendChild(playHint);
      media.addEventListener('play', () => { if (playHint && playHint.parentElement) playHint.remove(); });
    });
  }

  overlay.appendChild(closeBtn);
  overlay.appendChild(media);

  if (caption) {
    const cap = document.createElement('div');
    cap.style.color = '#fff';
    cap.style.marginTop = '12px';
    cap.style.textAlign = 'center';
    cap.style.zIndex = 10001;
    cap.innerText = caption;
    overlay.appendChild(cap);
  }

  overlay.addEventListener('click', (e) => {
    if (e.target === overlay) overlay.remove();
  });

  function onKey(e){
    if (e.key === 'Escape') { overlay.remove(); document.removeEventListener('keydown', onKey); }
  }
  document.addEventListener('keydown', onKey);

  document.body.appendChild(overlay);
}


    const gallery = $('#gallery');
    if(gallery) gallery.addEventListener('click', (e)=> {
      const card = e.target.closest('.card-media');
      if(!card) return;
      openLightbox(card.dataset.type, card.dataset.src);
    });
    document.querySelectorAll('.card-media').forEach(el=> el.addEventListener('keydown', (e)=> { if(e.key==='Enter' || e.key===' ') { e.preventDefault(); el.click(); }}));
  })();

  /* ============================
     Quotes-page audio player
     ============================ */
  (function quotesAudioInit(){
    // mapping - put your mp3 files into assets/
    const qSources = { rom1: 'assets/rom1.mp3', rom2: 'assets/rom2.mp3', rom3: 'assets/rom3.mp3' };
    const qAudio = new Audio();
    qAudio.loop = true;
    qAudio.preload = 'none';
    const playBtn = $('#quotesPlay');
    const select = $('#quotesSongSelect');
    const status = $('#quotesAudioStatus');

    async function isAvailable(url){
      try { const res = await fetch(url, { method: 'HEAD' }); return res.ok; } catch(e){ return false; }
    }

    async function setSource(key){
      const url = qSources[key];
      if(!url){ status.innerText = 'No song selected'; return false; }
      const ok = await isAvailable(url);
      if(!ok){ status.innerText = 'Audio not found in assets/ (add ' + url + ')'; return false; }
      qAudio.src = url;
      status.innerText = '';
      return true;
    }

    // Play/pause toggle
    playBtn?.addEventListener('click', async ()=>{
      if(qAudio.paused && qAudio.src){
        try {
          await qAudio.play();
          playBtn.innerText = 'Pause ⏸';
          playBtn.setAttribute('aria-pressed','true');
          status.innerText = '';
        } catch(e){
          status.innerText = 'Playback blocked — tap anywhere or try again';
        }
      } else if(qAudio.paused && !qAudio.src) {
        // first-time load: set source then play
        const key = select.value;
        const ok = await setSource(key);
        if(ok){
          try { await qAudio.play(); playBtn.innerText = 'Pause ⏸'; playBtn.setAttribute('aria-pressed','true'); status.innerText = ''; } catch(e){ status.innerText = 'Playback blocked — tap to allow'; }
        }
      } else {
        qAudio.pause();
        playBtn.innerText = 'Play ▶';
        playBtn.setAttribute('aria-pressed','false');
      }
    });

    // change source while playing
    select?.addEventListener('change', async ()=>{
      const k = select.value;
      const ok = await setSource(k);
      if(ok){
        // if playing, restart on new source
        if(!qAudio.paused){
          try { await qAudio.play(); } catch(e){ /* ignore */ }
        }
      }
    });

    // try to pre-check existence to show hint (non-blocking)
    (async function preCheck(){
      const k = select.value;
      await setSource(k);
    })();
  })();

  /* ============================
     Lazy-loading (images + videos)
     ============================ */
  let lazyObserver = null;
  (function lazyInit(){
    const lazyImgs = document.querySelectorAll('.lazy-img');
    const lazyVideos = document.querySelectorAll('.lazy-video');
    lazyObserver = ('IntersectionObserver' in window) ? new IntersectionObserver((entries, obs) => {
      entries.forEach(entry => {
        if(entry.isIntersecting){
          const el = entry.target;
          try {
            if(el.tagName.toLowerCase() === 'img'){
              const src = el.getAttribute('data-src');
              if(src){ el.src = src; el.removeAttribute('data-src'); }
              obs.unobserve(el);
            } else if(el.tagName.toLowerCase() === 'video'){
              const src = el.getAttribute('data-src');
              if(src){ el.src = src; el.load(); el.removeAttribute('data-src'); }
              obs.unobserve(el);
            }
          } catch(err){ console.warn('lazy load err', err); }
        }
      });
    }, {rootMargin:'200px 0px 200px 0px', threshold:0.01}) : null;
    lazyImgs.forEach(img => { if(lazyObserver) lazyObserver.observe(img); else if(img.getAttribute('data-src')) { img.src = img.getAttribute('data-src'); img.removeAttribute('data-src'); }});
    lazyVideos.forEach(v => { if(lazyObserver) lazyObserver.observe(v); else { const src=v.getAttribute('data-src'); if(src){ v.src=src; v.removeAttribute('data-src'); }}});

    // re-observe newly inserted lazy images when SPA view changes
    window.addEventListener('hashchange', ()=> {
      document.querySelectorAll('.lazy-img').forEach(img => { if(lazyObserver) lazyObserver.observe(img); });
      document.querySelectorAll('.lazy-video').forEach(v => { if(lazyObserver) lazyObserver.observe(v); });
    });
  })();

  /* final polish */
  try { $('#year').innerText = new Date().getFullYear(); console.log('SPA ready'); } catch(e){}
});
</script>
</body>
</html>



